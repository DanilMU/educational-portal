# Коллекция Postman для API образовательной платформы

Этот документ описывает коллекцию запросов API для образовательной платформы.

## Базовый URL

Базовый URL для всех запросов: `http://localhost:3000/api`.

---

## 1. Аутентификация (`/auth`)

### 1.1. Регистрация нового пользователя

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/auth/register`
*   **Описание:** Создает новую учетную запись пользователя и возвращает токен доступа.
*   **Тело:** `raw` (JSON)

    ```json
    {
      "email": "user@example.com",
      "password": "password123",
      "name": "Test User"
    }
    ```

### 1.2. Вход существующего пользователя

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/auth/login`
*   **Описание:** Аутентифицирует пользователя и возвращает токен доступа.
*   **Тело:** `raw` (JSON)

    ```json
    {
      "email": "user@example.com",
      "password": "password123"
    }
    ```

### 1.3. Обновление токена доступа

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/auth/refresh`
*   **Описание:** Генерирует новый токен доступа с использованием токена обновления, хранящегося в куках. Тело не требуется. Токен обновления автоматически отправляется клиентом (например, браузером или Postman), если он был получен в ответе на вход/регистрацию.

### 1.4. Выход пользователя

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/auth/logout`
*   **Описание:** Очищает куки аутентификации.

---

## 2. Пользователи (`/users`)

Требуется заголовок `Authorization` с `Bearer <accessToken>`.

### 2.1. Получить профиль текущего пользователя

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/users/@me`
*   **Описание:** Возвращает профиль текущего аутентифицированного пользователя.
*   **Auth:** Bearer Token.

### 2.2. Обновить профиль текущего пользователя

*   **Метод:** `PATCH`
*   **URL:** `{{baseUrl}}/users/@me`
*   **Описание:** Обновляет профиль текущего аутентифицированного пользователя.
*   **Auth:** Bearer Token.
*   **Тело:** `raw` (JSON)

    ```json
    {
      "name": "New Name",
      "email": "new-email@example.com"
    }
    ```

### 2.3. Получить всех пользователей (только для администраторов)

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/users`
*   **Описание:** Возвращает список всех пользователей. Требует права администратора.
*   **Auth:** Bearer Token (от администратора).

### 2.4. Создать нового пользователя (только для администраторов)

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/users`
*   **Описание:** Создает нового пользователя. Требует права администратора.
*   **Auth:** Bearer Token (от администратора).
*   **Тело:** `raw` (JSON)

    ```json
    {
      "email": "newuser@example.com",
      "password": "password123",
      "name": "New User",
      "role": "USER"
    }
    ```

### 2.5. Обновить пользователя (только для администраторов)

*   **Метод:** `PATCH`
*   **URL:** `{{baseUrl}}/users/:id`
*   **Описание:** Обновляет пользователя по его ID. Требует права администратора.
*   **Auth:** Bearer Token (от администратора).
*   **Параметры пути:**
    *   `id`: ID пользователя для обновления.
*   **Тело:** `raw` (JSON)

    ```json
    {
      "name": "Updated Name",
      "role": "ADMIN"
    }
    ```

---

## 3. Предметы (`/subjects`)

### 3.1. Получить все предметы

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/subjects`
*   **Описание:** Возвращает список всех предметов.

### 3.2. Получить один предмет

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/subjects/:id`
*   **Описание:** Возвращает один предмет по его ID.
*   **Параметры пути:**
    *   `id`: ID предмета для получения.

### 3.3. Создать новый предмет (только для администраторов/модераторов)

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/subjects`
*   **Описание:** Создает новый предмет. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Тело:** `raw` (JSON)

    ```json
    {
      "name": "New Subject Name",
      "description": "A description for the new subject."
    }
    ```

### 3.4. Обновить предмет (только для администраторов/модераторов)

*   **Метод:** `PATCH`
*   **URL:** `{{baseUrl}}/subjects/:id`
*   **Описание:** Обновляет предмет по его ID. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Параметры пути:**
    *   `id`: ID предмета для обновления.
*   **Тело:** `raw` (JSON)

    ```json
    {
      "name": "Updated Subject Name"
    }
    ```

### 3.5. Удалить предмет (только для администраторов/модераторов)

*   **Метод:** `DELETE`
*   **URL:** `{{baseUrl}}/subjects/:id`
*   **Описание:** Удаляет предмет по его ID. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Параметры пути:**
    *   `id`: ID предмета для удаления.

---

## 4. Темы (`/topics`)

### 4.1. Получить все темы

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/topics`
*   **Описание:** Возвращает список всех тем.

### 4.2. Получить одну тему

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/topics/:id`
*   **Описание:** Возвращает одну тему по ее ID.
*   **Параметры пути:**
    *   `id`: ID темы для получения.

### 4.3. Создать новую тему (только для администраторов/модераторов)

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/topics`
*   **Описание:** Создает новую тему. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Тело:** `raw` (JSON)

    ```json
    {
      "name": "New Topic Name",
      "subjectId": "subject-id-goes-here"
    }
    ```

### 4.4. Обновить тему (только для администраторов/модераторов)

*   **Метод:** `PATCH`
*   **URL:** `{{baseUrl}}/topics/:id`
*   **Описание:** Обновляет тему по ее ID. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Параметры пути:**
    *   `id`: ID темы для обновления.
*   **Тело:** `raw` (JSON)

    ```json
    {
      "name": "Updated Topic Name"
    }
    ```

### 4.5. Удалить тему (только для администраторов/модераторов)

*   **Метод:** `DELETE`
*   **URL:** `{{baseUrl}}/topics/:id`
*   **Описание:** Удаляет тему по ее ID. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Параметры пути:**
    *   `id`: ID темы для удаления.

---

## 5. Уроки (`/lessons`)

### 5.1. Получить все уроки

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/lessons`
*   **Описание:** Возвращает список всех уроков.

### 5.2. Получить один урок

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/lessons/:id`
*   **Описание:** Возвращает один урок по его ID.
*   **Параметры пути:**
    *   `id`: ID урока для получения.

### 5.3. Создать новый урок (только для администраторов/модераторов)

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/lessons`
*   **Описание:** Создает новый урок. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Тело:** `raw` (JSON)

    ```json
    {
      "title": "New Lesson Title",
      "content": "Content of the lesson.",
      "topicId": "topic-id-goes-here"
    }
    ```

### 5.4. Обновить урок (только для администраторов/модераторов)

*   **Метод:** `PATCH`
*   **URL:** `{{baseUrl}}/lessons/:id`
*   **Описание:** Обновляет урок по его ID. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Параметры пути:**
    *   `id`: ID урока для обновления.
*   **Тело:** `raw` (JSON)

    ```json
    {
      "title": "Updated Lesson Title"
    }
    ```

### 5.5. Удалить урок (только для администраторов/модераторов)

*   **Метод:** `DELETE`
*   **URL:** `{{baseUrl}}/lessons/:id`
*   **Описание:** Удаляет урок по его ID. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Параметры пути:**
    *   `id`: ID урока для удаления.

---

## 6. Викторины (`/quizzes`)

### 6.1. Получить все викторины

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/quizzes`
*   **Описание:** Возвращает список всех викторин.
*   **Auth:** Bearer Token.

### 6.2. Получить одну викторину

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/quizzes/:id`
*   **Описание:** Возвращает одну викторину по ее ID.
*   **Auth:** Bearer Token.
*   **Параметры пути:**
    *   `id`: ID викторины для получения.

### 6.3. Создать новую викторину (только для администраторов/модераторов)

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/quizzes`
*   **Описание:** Создает новую викторину. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Тело:** `raw` (JSON)

    ```json
    {
      "title": "New Quiz Title",
      "topicId": "topic-id-goes-here",
      "questions": [
        {
          "text": "What is 2+2?",
          "answers": [
            { "text": "3", "isCorrect": false },
            { "text": "4", "isCorrect": true }
          ]
        }
      ]
    }
    ```

### 6.4. Обновить викторину (только для администраторов/модераторов)

*   **Метод:** `PATCH`
*   **URL:** `{{baseUrl}}/quizzes/:id`
*   **Описание:** Обновляет викторину по ее ID. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Параметры пути:**
    *   `id`: ID викторины для обновления.
*   **Тело:** `raw` (JSON)

    ```json
    {
      "title": "Updated Quiz Title"
    }
    ```

### 6.5. Удалить викторину (только для администраторов/модераторов)

*   **Метод:** `DELETE`
*   **URL:** `{{baseUrl}}/quizzes/:id`
*   **Описание:** Удаляет викторину по ее ID. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Параметры пути:**
    *   `id`: ID викторины для удаления.

### 6.6. Отправить викторину

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/quizzes/:id/submit`
*   **Описание:** Отправляет ответы пользователя на викторину и возвращает результат.
*   **Auth:** Bearer Token.
*   **Параметры пути:**
    *   `id`: ID викторины для отправки.
*   **Тело:** `raw` (JSON)

    ```json
    {
      "answers": [
        {
          "questionId": "question-id-goes-here",
          "answerId": "answer-id-goes-here"
        }
      ]
    }
    ```

---

## 7. Прогресс (`/progress`)

Все конечные точки требуют заголовок `Authorization` с `Bearer <accessToken>`.

### 7.1. Получить весь прогресс для текущего пользователя

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/progress`
*   **Описание:** Возвращает все записи прогресса для текущего аутентифицированного пользователя.
*   **Auth:** Bearer Token.

### 7.2. Получить прогресс для конкретного урока

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/progress/:lessonId`
*   **Описание:** Возвращает прогресс для конкретного урока для текущего аутентифицированного пользователя.
*   **Auth:** Bearer Token.
*   **Параметры пути:**
    *   `lessonId`: ID урока.

### 7.3. Создать новую запись прогресса (только для администраторов/модераторов)

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/progress`
*   **Описание:** Создает новую запись прогресса для аутентифицированного администратора/модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Тело:** `raw` (JSON)

    ```json
    {
      "lessonId": "lesson-id-goes-here",
      "isCompleted": true
    }
    ```

### 7.4. Обновить запись прогресса (только для администраторов/модераторов)

*   **Метод:** `PATCH`
*   **URL:** `{{baseUrl}}/progress/:lessonId`
*   **Описание:** Обновляет запись прогресса для аутентифицированного администратора/модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Параметры пути:**
    *   `lessonId`: ID урока.
*   **Тело:** `raw` (JSON)

    ```json
    {
      "isCompleted": false
    }
    ```

### 7.5. Удалить запись прогресса (только для администраторов/модераторов)

*   **Метод:** `DELETE`
*   **URL:** `{{baseUrl}}/progress/:lessonId`
*   **Описание:** Удаляет запись прогресса для аутентифицированного администратора/модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Параметры пути:**
    *   `lessonId`: ID урока.

### 7.6. Завершить все уроки по предмету (только для администраторов/модераторов)

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/progress/complete-subject`
*   **Описание:** Отмечает все уроки в заданном предмете как завершенные для конкретного пользователя. Это удобная конечная точка для администраторов/модераторов, облегчающая тестирование.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Тело:** `raw` (JSON)

    ```json
    {
      "userId": "user-id-to-complete-for",
      "subjectId": "subject-id-to-complete"
    }
    ```

---

## 8. Сертификаты (`/certificates`)

Все конечные точки требуют заголовок `Authorization` с `Bearer <accessToken>`.

### 8.1. Получить все сертификаты (только для администраторов)

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/certificates`
*   **Описание:** Возвращает список всех сертификатов. Требует права администратора.
*   **Auth:** Bearer Token (от администратора).

### 8.2. Получить сертификаты для конкретного пользователя

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/certificates/user/:userId`
*   **Описание:** Возвращает все сертификаты для конкретного пользователя. Может быть доступен самим пользователем или администратором.
*   **Auth:** Bearer Token.
*   **Параметры пути:**
    *   `userId`: ID пользователя.

### 8.3. Получить один сертификат

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}/certificates/:id`
*   **Описание:** Возвращает один сертификат по его ID. Пользователь должен быть владельцем сертификата или администратором.
*   **Auth:** Bearer Token.
*   **Параметры пути:**
    *   `id`: ID сертификата для получения.

### 8.4. Создать новый сертификат (только для администраторов/модераторов)

*   **Метод:** `POST`
*   **URL:** `{{baseUrl}}/certificates`
*   **Описание:** Создает новый сертификат для пользователя после успешного завершения предмета. Требует права администратора или модератора.
*   **Auth:** Bearer Token (от администратора или модератора).
*   **Тело:** `raw` (JSON)

    ```json
    {
      "userId": "user-id-goes-here",
      "subjectId": "subject-id-goes-here"
    }
    ```

### 8.5. Скачать PDF сертификата

*   **Метод:** `GET`
*   **URL:** `{{baseUrl}}`
*   **Описание:** Генерирует и скачивает PDF сертификата по заданному ID. Может быть доступен владельцем сертификата или администратором.
*   **Auth:** Bearer Token.
*   **Параметры пути:**
    *   `id`: ID сертификата для скачивания.
*   **Использование в Postman:** Используйте опцию "Send and Download", чтобы сохранить ответ как PDF файл.

---

## 9. Тестирование генерации сертификата

В этом разделе описывается сквозной процесс тестирования генерации сертификата.

### Шаг 1: Завершить все уроки для пользователя (как администратор/модератор)

Чтобы выдать сертификат, пользователь должен сначала завершить все уроки по предмету. Используйте удобную конечную точку, чтобы сделать это быстро.

1.  **Аутентифицируйтесь** как администратор или модератор, чтобы получить `accessToken`.
2.  **Запрос**: `POST {{baseUrl}}/progress/complete-subject`
3.  **Заголовок**: `Authorization: Bearer <your_admin_token>`
4.  **Тело**: Укажите ID студента и ID предмета, который вы хотите отметить как завершенный.
    ```json
    {
      "userId": "student-user-id",
      "subjectId": "the-subject-id"
    }
    ```
5.  **Ответ**: API вернет количество созданных записей прогресса.

### Шаг 2: Создать запись сертификата (как администратор/модератор)

Теперь, когда предварительное условие выполнено, создайте сертификат.

1.  **Запрос**: `POST {{baseUrl}}/certificates`
2. **Заголовок**: `Authorization: Bearer <your_admin_token>`
3.  **Тело**:
    ```json
    {
      "userId": "student-user-id",
      "subjectId": "the-subject-id"
    }
    ```
4.  **Ответ**: При успешном выполнении API вернет объект сертификата. Скопируйте `id` из этого ответа.

### Шаг 3: Скачать PDF сертификата

Наконец, скачайте сгенерированный PDF, чтобы проверить его содержимое.

1.  **Запрос**: `GET {{baseUrl}}/certificates/<certificate_id>/download` (замените `<certificate_id>` на ID из шага 2).
2.  **Заголовок**: `Authorization: Bearer <student_token_or_admin_token>` (может быть скачан как студентом, так и администратором).
3.  **Действие в Postman**: Нажмите стрелку рядом с кнопкой "Send" и выберите **"Send and Download"**.
4.  **Проверка**: Postman предложит вам сохранить файл. Сохраните его, затем откройте PDF, чтобы убедиться, что имя студента, название предмета и дата выдачи указаны правильно.

---

## 10. Тестирование завершения всех уроков

В этом разделе описывается процесс тестирования завершения всех уроков в предмете.

### Шаг 1: Подготовка тестовых данных

1. Убедитесь, что у вас есть пользователь с ролью `ADMIN` или `MODERATOR`.
2.  Убедитесь, что у вас есть пользователь с ролью `STUDENT`.
3.  Убедитесь, что у вас есть `Subject` с хотя бы одним `Lesson`.
4.  Убедитесь, что у вас есть доступ к ID всех уроков в выбранном предмете.

### Шаг 2: Завершить все уроки для студента (как администратор/модератор)

Используйте удобную конечную точку для быстрого завершения всех уроков по предмету:

1.  **Аутентифицируйтесь** как администратор или модератор, чтобы получить `accessToken`.
2.  **Запрос**: `POST {{baseUrl}}/progress/complete-subject`
3.  **Заголовок**: `Authorization: Bearer <your_admin_token>`
4.  **Тело**: Укажите ID студента и ID предмета, все уроки в котором нужно завершить.
    ```json
    {
      "userId": "student-user-id",
      "subjectId": "the-subject-id"
    }
    ```
5.  **Ответ**: API вернет количество созданных записей прогресса. Убедитесь, что количество совпадает с количеством уроков в предмете.

### Шаг 3: Проверить статус прогресса студента

1.  **Запрос**: `GET {{baseUrl}}/progress`
2.  **Заголовок**: `Authorization: Bearer <student_token>`
3.  **Ответ**: Проверьте, что все уроки в интересующем предмете отмечены как завершенные (`isCompleted: true`).

### Шаг 4: Проверить завершение предмета через викторину (альтернативный способ)

1.  **Аутентифицируйтесь** как студент.
2.  **Запрос**: `POST {{baseUrl}}/quizzes/:id/submit` (где `:id` - ID викторины, связанной с последним уроком в предмете).
3.  **Заголовок**: `Authorization: Bearer <student_token>`
4.  **Тело**: Правильные ответы на все вопросы викторины.
5.  **Ответ**: При успешном прохождении викторины с оценкой 100%, урок должен быть автоматически отмечен как завершенный.

### Шаг 5: Создание сертификата (если все уроки завершены)

Если все уроки в предмете завершены, можно создать сертификат:

1.  **Аутентифицируйтесь** как администратор или модератор.
2.  **Запрос**: `POST {{baseUrl}}/certificates`
3.  **Заголовок**: `Authorization: Bearer <your_admin_token>`
4.  **Тело**:
    ```json
    {
      "userId": "student-user-id",
      "subjectId": "the-subject-id"
    }
    ```
5.  **Ответ**: При успешном выполнении будет создан сертификат, подтверждающий завершение предмета.
